<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>

    <script src="https://code.jquery.com/jquery-3.3.1.js" integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60=" crossorigin="anonymous"></script>

    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

    <!-- Optional theme -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/momentjs/2.12.0/moment.min.js"></script>
    </script>
    <style>
        body {
            background-image: url("assets/mainbg.jpeg");
            margin-top: 15px;
        }

        .jumbotron {
            text-align: center;
            background-image: url("assets/jumbotronbg.jpg");
            background-size: cover;
            background-position: bottom;
            color: #58B9F7;
        }
    </style>

</head>
<body>
    <div class="container">
        <div class="jumbotron">
            <div class="container">
                <h1> Train Scheduler </h1>
            </div>
        </div>

        <div class="panel panel-primary">
            <div class="panel-heading">
                <h3 class="panel-title">Train Scheduler</h3>
            </div>
            <div class="panel-body">
                <table style="width:100%"> 
                    <thead>
                        <th>Train Name </th>
                        <th>Destination </th>
                        <th>Frequency (min) </th>
                        <th>Next Arrival </th>
                        <th>Minutes Away</th>
                    </thead>
                    <tbody id="traininfo"> </tbody>
                </table>
            </div>
        </div>

        <div class="panel panel-primary">
            <div class="panel-heading">
                <h3 class="panel-title">Add a Train</h3>
            </div>
            <div class="panel-body">
                <label class="control-label" for="trainName-input">Train Name</label><br>
                    <input type="" class="form-control" id="trainName-input" placeholder="">
                
                <label class="control-label" for="destination-input">Destination</label><br>
                    <input type="" class="form-control" id="destination-input" placeholder="">
                
                <label class="control-label" for="trainTime-input">First Train Time(HH:mm - military time)</label><br>
                    <input type="" class="form-control" id="trainTime-input" placeholder="">
               
                <label class="control-label" for="freq-input">Frequency</label><br>
                    <input type="" class="form-control" id="freq-input" placeholder="">
                
                <button id="submit" type="submit" class="btn btn-default">Submit</button>
            </div>
        </div>
    </div>
</body>
</html>


<script src="https://www.gstatic.com/firebasejs/4.13.0/firebase.js"></script>
<script>
    var config = {
        apiKey: "AIzaSyCtLw4aygkGmFsg7qEIttOKRKku5r6Ey6M",
        authDomain: "trainapp-60e68.firebaseapp.com",
        databaseURL: "https://trainapp-60e68.firebaseio.com",
        projectId: "trainapp-60e68",
        storageBucket: "trainapp-60e68.appspot.com",
        messagingSenderId: "780865836584"
    };

    firebase.initializeApp(config);

    var database = firebase.database();

    $("#submit").on("click", function(event){
        event.preventDefault();

        var name = $("#trainName-input").val().trim();
        var dest = $("#destination-input").val().trim();
        var time = $("#trainTime-input").val().trim();
        var freq = $("#freq-input").val().trim();

        var newTrain = {
            Name: name,
            Destination: dest,
            Time: time,
            Frequency: freq
        };

        database.ref().push(newTrain);

        //console.log(newTrain.Name);
        //console.log(newTrain.Destination);
        //console.log(newTrain.Time);
        //console.log(newTrain.Frequency);

        $("#trainName-input").val("");
        $("#destination-input").val("");
        $("#trainTime-input").val("");
        $("#freq-input").val("");
    });

    database.ref().on("child_added", function(childSnapshot, prevChildKey) {
        console.log(childSnapshot.val());

        var trainName = childSnapshot.val().Name;
        var trainDest = childSnapshot.val().Destination;
        var trainTime = childSnapshot.val().Time;
        var trainFreq = childSnapshot.val().Frequency;    

        //console.log("Train Name: ", trainName);
        //console.log("Train Dest: ", trainDest);
        //console.log("Train Time: ", trainTime);
        //console.log("Train Freq: ", trainFreq);

    //Train Conversion
    var freq = parseInt(freq);
    var timeNow = moment();
    console.log("Current time in HH:MM: " + timeNow.format("HH:MM"));

    var Converted = moment(trainTime, 'HH:mm').subtract(1, 'years');
    var tTime = moment(Converted).format('HH:mm');

    var timeConverstion = moment(tTime, 'HH:mm').subtract(1, 'years');

    var timeDif = moment().diff(moment(timeConverstion), "minutes");
    console.log("DIFFERENCE IN TIME: " + timeDif);

    var tRemain = timeDif % trainFreq;
    console.log(tRemain);

    var minTillTrain = trainFreq - tRemain;
    console.log("MINUTES TILL TRAIN: " + minTillTrain);

    var nextTrain = moment().add(minTillTrain, "minutes");
    console.log("ARRIVAL TIME: " + moment(nextTrain).format("hh:mm"));


        //Add Data to Table
        $("tbody").append(
                                "<tr><td>" + trainName + "</td>" +
                                "<td>" + trainDest + "</td>" +
                                "<td>" + trainFreq + "</td>" + 
                                "<td>" + moment(nextTrain).format("HH:mm") + "</td>" +
                                "<td>" + minTillTrain + "</td></tr>"
                                );
    });
</script>

